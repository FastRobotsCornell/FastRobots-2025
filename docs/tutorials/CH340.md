# CH340 USB to Serial

## Introduction

For most users, the CH340 driver software is embedded in their USB Serial drivers in their OS. For those that fail to communicate with the Artemis, even after following the debug steps in Lab 1A, you may need to install dedicated USB drivers from WCH and configure the SVL bootloader to enable proper communication between the computer and the Artemis board over USB.

## Install CH340 Drivers

WCH makes drivers for each of their ICs and various operating systems. **Please follow all instructions in their PDF (dowloaded with the ZIP file to properly install the driver.**

<div class="tab">
  <button class="tablinks 1 active" onclick="openTab(event, 'L1', '1')">Linux/FreeBSD</button>
  <button class="tablinks 1" onclick="openTab(event, 'W1', '1')">Windows</button>
  <button class="tablinks 1" onclick="openTab(event, 'M1', '1')">macOS</button>
</div>

<div id="L1" class="tabcontent 1" style="display: block">
  <p>[CH341SER_LINUX.ZIP](https://www.wch-ic.com/downloads/CH341SER_LINUX_ZIP.html)</p>
</div>

<div id="W1" class="tabcontent 1">
  <p>[CH341SER.EXE](https://www.wch-ic.com/downloads/CH341SER_EXE.html)</p>
</div>

<div id="M1" class="tabcontent 1">
  <blockquote>
      <p>This is mentioned in the install instructions PDF, but please only install the dmg</p>
  </blockquote>
  <ol>
    <li>Open a terminal and run the command: <code class="language-plaintext highlighter-rouge">python3</code></li>
    <li>This should bring up a xcode dialog box asking you to install the necessary software.</li>
  </ol>
</div>

Vist the [WCH downloads page](https://www.wch-ic.com/search?q=CH340&t=downloads) to check for the most up-to-date drivers.

## Ensure board communication
After successful install, you should reopen Arduino and see a /dev/cu.wchusbserial* port. Unplug your Artemis, plug it back in, ensure correct board and port definitions, use the SVL bootloader, and burn the Blink example. Code should upload. If it does not, double check the CH340 install.

Modify the timing of the blink example and try to reupload the code (do not unplug the board). If you can successfully upload code, the driver install was the only fix needed.

## Update SVL bootloader

The Artemis boards are equipped with two bootloaders. The Sparkfun Variable Loader (SVL) and the Ambiq Secure Bootloader (ASB). For the purposes of this class, we only need to use the SVL bootloader. Note: If you use the ASB, you may accidentally rewrite the registers for the SVL on the Apollo3 chip, you will need to reburn the SVL bootloader on the chip for future use of SVL. 

When we added the apollo3 board package to the Arduino IDE, the library contents were saved in Arduino's Library folder. Deep in these folders is the SVL executable that runs when we call the SVL bootloader in the Arduino IDE. 

## Detailed Description of the issue (for those that are curious)

The Artemis Nano uses a [CH340E](https://www.mpja.com/download/35227cpdata.pdf) USB to Serial IC to convert USB serial communication to the standard RX/TX signals for the Apollo3 MCU. 
